{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.json.stringify.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport CommonTag from \"../../src/components/CommonTag.vue\";\nimport CommonForm from \"../../src/components/CommonForm.vue\";\nimport NotFound from \"../../src/components/NotFound.vue\";\nimport { getImages, getUser, logout } from \"../../api/data.js\";\nexport default {\n  name: \"Home\",\n  components: {\n    CommonTag: CommonTag,\n    CommonForm: CommonForm,\n    NotFound: NotFound\n  },\n  inject: [\"reload\"],\n  data: function data() {\n    return {\n      isShow: false,\n      isImgShow: false,\n      isModify: false,\n      isPassword: false,\n      //使用require引入本地图片\n      user: {},\n      tableData: [],\n      tableLabel: {\n        type: \"图片类别\",\n        total: \"图片上传总数\"\n      },\n      countData: [],\n      tags: [],\n      imageUrl: \"\",\n      action: \"/api/upload/upload_head/\",\n      imgItem: {},\n      data: {\n        username: \"\"\n      },\n      userImg: \"\",\n      operateForm: {\n        classify: \"\"\n      },\n      operateFormLabel: [{\n        model: \"classify\",\n        label: \"图片分类\",\n        type: \"select\",\n        opts: []\n      }],\n      passwordForm: {\n        password: \"\"\n      },\n      passwordFormLabel: [{\n        model: \"password\",\n        label: \"密码\",\n        type: \"input\"\n      }]\n    };\n  },\n  methods: {\n    openHead: function openHead() {\n      this.isShow = true;\n      this.imageUrl = \"\";\n    },\n    openMessage: function openMessage(item) {\n      this.isImgShow = true;\n      this.imgItem = item;\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      var _this = this;\n\n      this.imageUrl = URL.createObjectURL(file.raw);\n      this.$message.success(\"上传头像成功\");\n      this.getHead();\n      console.log(\"success\");\n      setTimeout(function () {\n        _this.isShow = false;\n      }, 3000);\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var isJPG = file.type === \"image/jpeg\";\n      var isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error(\"上传头像图片只能是 JPG 格式!\");\n        return false;\n      }\n\n      if (!isLt2M) {\n        this.$message.error(\"上传头像图片大小不能超过 2MB!\");\n        return false;\n      }\n    },\n    loading: function loading(event, file, fileList) {\n      this.$message.success(\"正在上传头像，请稍等......\");\n    },\n    error: function error(err, file, fileList) {\n      var _this2 = this;\n\n      this.$message.error(\"上传头像失败,弹出3秒后自动关闭弹窗\");\n      setTimeout(function () {\n        _this2.isShow = false;\n      }, 3000);\n      console.log(\"error\");\n    },\n    getTagsList: function getTagsList() {\n      var _this3 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_classify_list\");\n      getImages(param).then(function (res) {\n        _this3.tags = res.data.retlist;\n        console.log(_this3.tags);\n        _this3.operateFormLabel[0].opts = res.data.retlist.slice(1);\n      });\n    },\n    getImagesList: function getImagesList() {\n      var _this4 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_image_list\");\n      param.append(\"username\", this.user.username);\n      param.append(\"classify\", \"\");\n      getImages(param).then(function (res) {\n        console.log(res.data.retlist);\n        _this4.countData = res.data.retlist;\n      });\n    },\n    getHead: function getHead() {\n      var _this5 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_head\");\n      param.append(\"username\", this.user.username);\n      getImages(param).then(function (res) {\n        _this5.user.webpath = res.data.webpath;\n\n        _this5.$store.commit(\"setUser\", JSON.stringify(_this5.user));\n\n        _this5.getTokenUser();\n\n        _this5.reload();\n      });\n    },\n    getTokenUser: function getTokenUser() {\n      this.$store.commit(\"getUser\");\n      this.user = JSON.parse(this.$store.state.user.user);\n      this.data.username = this.user.username;\n    },\n    clickMenu: function clickMenu(item) {\n      var _this6 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_image_list\");\n      param.append(\"username\", this.user.username);\n      param.append(\"classify\", item.value);\n      getImages(param).then(function (res) {\n        _this6.countData = res.data.retlist;\n      });\n    },\n    getImagesTotal: function getImagesTotal() {\n      var _this7 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_images_num\");\n      param.append(\"username\", this.user.username);\n      getImages(param).then(function (res) {\n        _this7.tableData = res.data.retlist;\n      });\n    },\n    confirm: function confirm() {\n      var _this8 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"modify_image\");\n      param.append(\"classify\", this.operateForm.classify);\n      param.append(\"filename\", this.filename);\n      getImages(param).then(function (res) {\n        var ret = res.data[\"ret\"];\n        var msg = res.data[\"msg\"];\n\n        if (ret === 0) {\n          _this8.$message.success(msg);\n\n          _this8.isModify = false;\n        } else {\n          _this8.$message.error(msg);\n        }\n\n        _this8.getImagesList();\n      });\n    },\n    openPassword: function openPassword() {\n      this.isPassword = true;\n      this.passwordForm.password = \"\";\n    },\n    modifyPasword: function modifyPasword() {\n      var _this9 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"modify_password\");\n      param.append(\"username\", this.user.username);\n      param.append(\"password\", this.passwordForm.password);\n      getUser(param).then(function (res) {\n        var ret = res.data[\"ret\"];\n        var msg = res.data[\"msg\"];\n\n        if (ret === 0) {\n          _this9.$message.success(msg + \"，请重新登录\");\n\n          var _param = new URLSearchParams();\n\n          _param.append(\"username\", _this9.user.username);\n\n          logout(_param).then(function (res) {\n            var ret = res.data[\"ret\"];\n            var msg = res.data[\"msg\"];\n\n            if (ret === 0) {\n              _this9.$store.commit(\"clearToken\");\n\n              _this9.$store.commit(\"clearMenu\");\n\n              _this9.$store.commit(\"clearUser\");\n\n              _this9.$router.push({\n                name: \"Login\"\n              });\n            }\n          });\n        } else {\n          _this9.$message.error(msg);\n        }\n      });\n    },\n    delImage: function delImage(item) {\n      var _this10 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"delete_image\");\n      param.append(\"username\", this.user.username);\n      param.append(\"filename\", item.filename);\n      param.append(\"address\", \"home\");\n      this.$confirm(\"此操作将永久删除该照片,是否继续\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        getImages(param).then(function (res) {\n          var ret = res.data[\"ret\"];\n          var msg = res.data[\"msg\"];\n\n          if (ret === 0) {\n            _this10.$message.success(msg);\n          } else {\n            _this10.$message.error(msg);\n          }\n\n          _this10.getImagesList();\n\n          _this10.isImgShow = false;\n        });\n      }).catch(function () {}); //注意这里，这里是重点！！！;\n    },\n    editImage: function editImage(item) {\n      this.isImgShow = false;\n      this.isModify = true;\n      this.operateForm.classify = item.classify;\n      this.filename = item.filename;\n    }\n  },\n  computed: {\n    length: function length() {\n      return this.countData.length;\n    }\n  },\n  created: function created() {\n    this.getTokenUser();\n    this.getTagsList();\n    this.getImagesList();\n    this.getImagesTotal();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;AACA;AACA;AAEA;AACAA,cADA;AAEAC;AAAAC;AAAAC;AAAAC;AAAA,GAFA;AAGAC,oBAHA;AAIAC,MAJA,kBAIA;AACA;AACAC,mBADA;AAEAC,sBAFA;AAGAC,qBAHA;AAIAC,uBAJA;AAKA;AACAC,cANA;AAOAC,mBAPA;AAQAC;AACAC,oBADA;AAEAC;AAFA,OARA;AAYAC,mBAZA;AAaAC,cAbA;AAcAC,kBAdA;AAeAC,wCAfA;AAgBAC,iBAhBA;AAiBAd;AACAe;AADA,OAjBA;AAoBAC,iBApBA;AAqBAC;AACAC;AADA,OArBA;AAwBAC,yBACA;AACAC,yBADA;AAEAC,qBAFA;AAGAb,sBAHA;AAIAc;AAJA,OADA,CAxBA;AAgCAC;AACAC;AADA,OAhCA;AAmCAC,0BACA;AACAL,yBADA;AAEAC,mBAFA;AAGAb;AAHA,OADA;AAnCA;AA2CA,GAhDA;AAiDAkB;AACAC,YADA,sBACA;AACA;AACA;AACA,KAJA;AAKAC,eALA,uBAKAC,IALA,EAKA;AACA;AACA;AACA,KARA;AASAC,uBATA,+BASAC,GATA,EASAC,IATA,EASA;AAAA;;AACA;AACA;AACA;AACAC;AACAC;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KAjBA;AAkBAC,sBAlBA,8BAkBAH,IAlBA,EAkBA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,KA9BA;AA+BAI,WA/BA,mBA+BAC,KA/BA,EA+BAL,IA/BA,EA+BAM,QA/BA,EA+BA;AACA;AACA,KAjCA;AAkCAC,SAlCA,iBAkCAC,GAlCA,EAkCAR,IAlCA,EAkCAM,QAlCA,EAkCA;AAAA;;AACA;AACAJ;AACA;AACA,OAFA,EAEA,IAFA;AAGAD;AACA,KAxCA;AAyCAQ,eAzCA,yBAyCA;AAAA;;AACA;AACAC;AACAC;AACA;AACAV;AACA;AACA,OAJA;AAKA,KAjDA;AAkDAW,iBAlDA,2BAkDA;AAAA;;AACA;AACAF;AACAA;AACAA;AACAC;AACAV;AACA;AACA,OAHA;AAIA,KA3DA;AA4DAY,WA5DA,qBA4DA;AAAA;;AACA;AACAH;AACAA;AACAC;AACA;;AACA;;AACA;;AACA;AACA,OALA;AAMA,KAtEA;AAuEAG,gBAvEA,0BAuEA;AACA;AACA;AACA;AACA,KA3EA;AA4EAC,aA5EA,qBA4EAlB,IA5EA,EA4EA;AAAA;;AACA;AACAa;AACAA;AACAA;AACAC;AACA;AACA,OAFA;AAGA,KApFA;AAqFAK,kBArFA,4BAqFA;AAAA;;AACA;AACAN;AACAA;AACAC;AACA;AACA,OAFA;AAGA,KA5FA;AA6FAM,WA7FA,qBA6FA;AAAA;;AACA;AACAP;AACAA;AACAA;AACAC;AACA;AACA;;AACA;AACA;;AACA;AACA,SAHA,MAGA;AACA;AACA;;AACA;AACA,OAVA;AAWA,KA7GA;AA8GAO,gBA9GA,0BA8GA;AACA;AACA;AACA,KAjHA;AAkHAC,iBAlHA,2BAkHA;AAAA;;AACA;AACAT;AACAA;AACAA;AACAU;AACA;AACA;;AACA;AACA;;AACA;;AACAV;;AACAW;AACA;AACA;;AACA;AACA;;AACA;;AACA;;AACA;AAAA3D;AAAA;AACA;AACA,WATA;AAUA,SAdA,MAcA;AACA;AACA;AACA,OApBA;AAqBA,KA5IA;AA6IA4D,YA7IA,oBA6IAzB,IA7IA,EA6IA;AAAA;;AACA;AACAa;AACAA;AACAA;AACAA;AACA;AACAa,+BADA;AAEAC,8BAFA;AAGAhD;AAHA,SAKAiD,IALA,CAKA;AACAd;AACA;AACA;;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;;AACA;;AACA;AACA,SAVA;AAWA,OAjBA,EAkBAe,KAlBA,CAkBA,cAlBA,EANA,CAwBA;AACA,KAtKA;AAuKAC,aAvKA,qBAuKA9B,IAvKA,EAuKA;AACA;AACA;AACA;AACA;AACA;AA5KA,GAjDA;AA+NA+B;AACAC,UADA,oBACA;AACA;AACA;AAHA,GA/NA;AAoOAC,SApOA,qBAoOA;AACA;AACA;AACA;AACA;AACA;AAzOA","names":["name","components","CommonTag","CommonForm","NotFound","inject","data","isShow","isImgShow","isModify","isPassword","user","tableData","tableLabel","type","total","countData","tags","imageUrl","action","imgItem","username","userImg","operateForm","classify","operateFormLabel","model","label","opts","passwordForm","password","passwordFormLabel","methods","openHead","openMessage","item","handleAvatarSuccess","res","file","console","setTimeout","beforeAvatarUpload","loading","event","fileList","error","err","getTagsList","param","getImages","getImagesList","getHead","getTokenUser","clickMenu","getImagesTotal","confirm","openPassword","modifyPasword","getUser","logout","delImage","confirmButtonText","cancelButtonText","then","catch","editImage","computed","length","created"],"sourceRoot":"views/home","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-row class=\"home\" :gutter=\"20\">\r\n      <el-dialog :visible.sync=\"isShow\" class=\"dialog\">\r\n        <h1 class=\"img_title\">头像上传</h1>\r\n        <el-upload\r\n          class=\"avatar-uploader\"\r\n          :action=\"action\"\r\n          :show-file-list=\"false\"\r\n          :on-success=\"handleAvatarSuccess\"\r\n          :on-progress=\"loading\"\r\n          :on-error=\"error\"\r\n          :before-upload=\"beforeAvatarUpload\"\r\n          :data=\"data\"\r\n        >\r\n          <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\" />\r\n          <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n        </el-upload>\r\n      </el-dialog>\r\n      <el-dialog title=\"修改用户密码\" :visible.sync=\"isPassword\">\r\n        <common-form\r\n          :formLabel=\"passwordFormLabel\"\r\n          :form=\"passwordForm\"\r\n          :inline=\"true\"\r\n          ref=\"form\"\r\n        />\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"isShow = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"modifyPasword\">确定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n      <el-col :span=\"8\" style=\"margin-top: 20px\">\r\n        <el-card shadow=\"hover\">\r\n          <div class=\"user\">\r\n            <img class=\"userImg\" :src=\"user.webpath\" @click=\"openHead\" />\r\n            <div class=\"userInfo\">\r\n              <p class=\"name\">{{ user.username }}</p>\r\n              <p class=\"access\">\r\n                {{ user.user_type === 0 ? \"普通用户\" : \"管理员\" }}\r\n              </p>\r\n              <el-button size=\"mini\" type=\"danger\" @click=\"openPassword\"\r\n                >修改密码</el-button\r\n              >\r\n            </div>\r\n          </div>\r\n          <div class=\"login-info\">\r\n            <p>\r\n              上次登录时间：<span>{{ user.last_login }}</span>\r\n            </p>\r\n          </div>\r\n        </el-card>\r\n\r\n        <el-card style=\"margin-top: 20px; height: 460px\">\r\n          <el-table :data=\"tableData\">\r\n            <el-table-column\r\n              v-for=\"(val, key) in tableLabel\"\r\n              :key=\"key\"\r\n              :prop=\"key\"\r\n              :label=\"val\"\r\n            >\r\n            </el-table-column>\r\n          </el-table>\r\n        </el-card>\r\n      </el-col>\r\n      <el-col :span=\"10\" style=\"margin-top: 20px\"\r\n        ><h1 class=\"header-title\">历史上传图片</h1>\r\n        <h1 class=\"title\">图片分类:</h1>\r\n        <common-tag :tags=\"tags\" @clickMenu=\"clickMenu\"></common-tag>\r\n        <el-dialog title=\"修改图片信息\" :visible.sync=\"isModify\">\r\n          <common-form\r\n            :formLabel=\"operateFormLabel\"\r\n            :form=\"operateForm\"\r\n            :inline=\"true\"\r\n            ref=\"form\"\r\n          />\r\n          <div slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"isModify = false\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"confirm\">确定</el-button>\r\n          </div>\r\n        </el-dialog>\r\n        <el-dialog\r\n          title=\"图片信息\"\r\n          :visible.sync=\"isImgShow\"\r\n          class=\"dialog-img\"\r\n        >\r\n          <div class=\"webpath\">图片名：{{ imgItem.filename }}</div>\r\n          <div class=\"webpath\">图片分类:{{ imgItem.classify }}</div>\r\n          <div class=\"webpath\">网络地址：{{ imgItem.webpath }}</div>\r\n          <div class=\"webpath\">上传日期：{{ imgItem.create_date }}</div>\r\n          <div slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"editImage(imgItem)\">编辑</el-button>\r\n            <el-button type=\"danger\" @click=\"delImage(imgItem)\">删除</el-button>\r\n            <el-button @click=\"isImgShow = false\">取消</el-button>\r\n          </div>\r\n        </el-dialog>\r\n        <not-found v-if=\"length === 0\" />\r\n        <div class=\"num\"  v-if=\"length !== 0\">\r\n          <el-card \r\n            v-for=\"(item, index) in countData\"\r\n            :key=\"index\"\r\n            :body-style=\"{ display: 'flex', padding: 0 }\"\r\n            class=\"el-card-img\"\r\n          >\r\n            <div>\r\n              <img class=\"userImg\" :src=\"item.webpath\" />\r\n              <div>\r\n                <span\r\n                  >查看详细：<a\r\n                    href=\"javascript:void(0)\"\r\n                    @click=\"openMessage(item)\"\r\n                    >点击显示</a\r\n                  ></span\r\n                >\r\n              </div>\r\n            </div>\r\n          </el-card>\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CommonTag from \"../../src/components/CommonTag.vue\";\r\nimport CommonForm from \"../../src/components/CommonForm.vue\";\r\nimport NotFound from \"../../src/components/NotFound.vue\";\r\nimport { getImages, getUser, logout } from \"../../api/data.js\";\r\n\r\nexport default {\r\n  name: \"Home\",\r\n  components: { CommonTag, CommonForm, NotFound },\r\n  inject: [\"reload\"],\r\n  data() {\r\n    return {\r\n      isShow: false,\r\n      isImgShow: false,\r\n      isModify: false,\r\n      isPassword: false,\r\n      //使用require引入本地图片\r\n      user: {},\r\n      tableData: [],\r\n      tableLabel: {\r\n        type: \"图片类别\",\r\n        total: \"图片上传总数\",\r\n      },\r\n      countData: [],\r\n      tags: [],\r\n      imageUrl: \"\",\r\n      action: \"/api/upload/upload_head/\",\r\n      imgItem: {},\r\n      data: {\r\n        username: \"\",\r\n      },\r\n      userImg: \"\",\r\n      operateForm: {\r\n        classify: \"\",\r\n      },\r\n      operateFormLabel: [\r\n        {\r\n          model: \"classify\",\r\n          label: \"图片分类\",\r\n          type: \"select\",\r\n          opts: [],\r\n        },\r\n      ],\r\n      passwordForm: {\r\n        password: \"\",\r\n      },\r\n      passwordFormLabel: [\r\n        {\r\n          model: \"password\",\r\n          label: \"密码\",\r\n          type: \"input\",\r\n        },\r\n      ],\r\n    };\r\n  },\r\n  methods: {\r\n    openHead() {\r\n      this.isShow = true;\r\n      this.imageUrl = \"\";\r\n    },\r\n    openMessage(item) {\r\n      this.isImgShow = true;\r\n      this.imgItem = item;\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      this.imageUrl = URL.createObjectURL(file.raw);\r\n      this.$message.success(\"上传头像成功\");\r\n      this.getHead();\r\n      console.log(\"success\");\r\n      setTimeout(() => {\r\n        this.isShow = false;\r\n      }, 3000);\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      const isJPG = file.type === \"image/jpeg\";\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error(\"上传头像图片只能是 JPG 格式!\");\r\n        return false\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error(\"上传头像图片大小不能超过 2MB!\");\r\n        return false\r\n      }\r\n    },\r\n    loading(event, file, fileList) {\r\n      this.$message.success(\"正在上传头像，请稍等......\");\r\n    },\r\n    error(err, file, fileList) {\r\n      this.$message.error(\"上传头像失败,弹出3秒后自动关闭弹窗\");\r\n      setTimeout(() => {\r\n        this.isShow = false;\r\n      }, 3000);\r\n      console.log(\"error\");\r\n    },\r\n    getTagsList() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_classify_list\");\r\n      getImages(param).then((res) => {\r\n        this.tags = res.data.retlist;\r\n        console.log(this.tags);\r\n        this.operateFormLabel[0].opts = res.data.retlist.slice(1);\r\n      });\r\n    },\r\n    getImagesList() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_image_list\");\r\n      param.append(\"username\", this.user.username);\r\n      param.append(\"classify\", \"\");\r\n      getImages(param).then((res) => {\r\n        console.log(res.data.retlist);\r\n        this.countData = res.data.retlist;\r\n      });\r\n    },\r\n    getHead() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_head\");\r\n      param.append(\"username\", this.user.username);\r\n      getImages(param).then((res) => {\r\n        this.user.webpath = res.data.webpath;\r\n        this.$store.commit(\"setUser\", JSON.stringify(this.user));\r\n        this.getTokenUser();\r\n        this.reload();\r\n      });\r\n    },\r\n    getTokenUser() {\r\n      this.$store.commit(\"getUser\");\r\n      this.user = JSON.parse(this.$store.state.user.user);\r\n      this.data.username = this.user.username;\r\n    },\r\n    clickMenu(item) {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_image_list\");\r\n      param.append(\"username\", this.user.username);\r\n      param.append(\"classify\", item.value);\r\n      getImages(param).then((res) => {\r\n        this.countData = res.data.retlist;\r\n      });\r\n    },\r\n    getImagesTotal() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_images_num\");\r\n      param.append(\"username\", this.user.username);\r\n      getImages(param).then((res) => {\r\n        this.tableData = res.data.retlist;\r\n      });\r\n    },\r\n    confirm() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"modify_image\");\r\n      param.append(\"classify\", this.operateForm.classify);\r\n      param.append(\"filename\", this.filename);\r\n      getImages(param).then((res) => {\r\n        var ret = res.data[\"ret\"];\r\n        var msg = res.data[\"msg\"];\r\n        if (ret === 0) {\r\n          this.$message.success(msg);\r\n          this.isModify = false;\r\n        } else {\r\n          this.$message.error(msg);\r\n        }\r\n        this.getImagesList();\r\n      });\r\n    },\r\n    openPassword() {\r\n      this.isPassword = true;\r\n      this.passwordForm.password = \"\";\r\n    },\r\n    modifyPasword() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"modify_password\");\r\n      param.append(\"username\", this.user.username);\r\n      param.append(\"password\", this.passwordForm.password);\r\n      getUser(param).then((res) => {\r\n        var ret = res.data[\"ret\"];\r\n        var msg = res.data[\"msg\"];\r\n        if (ret === 0) {\r\n          this.$message.success(msg + \"，请重新登录\");\r\n          let param = new URLSearchParams();\r\n          param.append(\"username\", this.user.username);\r\n          logout(param).then((res) => {\r\n            var ret = res.data[\"ret\"];\r\n            var msg = res.data[\"msg\"];\r\n            if (ret === 0) {\r\n              this.$store.commit(\"clearToken\");\r\n              this.$store.commit(\"clearMenu\");\r\n              this.$store.commit(\"clearUser\");\r\n              this.$router.push({ name: \"Login\" });\r\n            }\r\n          });\r\n        } else {\r\n          this.$message.error(msg);\r\n        }\r\n      });\r\n    },\r\n    delImage(item) {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"delete_image\");\r\n      param.append(\"username\", this.user.username);\r\n      param.append(\"filename\", item.filename);\r\n      param.append(\"address\", \"home\");\r\n      this.$confirm(\"此操作将永久删除该照片,是否继续\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(() => {\r\n          getImages(param).then((res) => {\r\n            var ret = res.data[\"ret\"];\r\n            var msg = res.data[\"msg\"];\r\n            if (ret === 0) {\r\n              this.$message.success(msg);\r\n            } else {\r\n              this.$message.error(msg);\r\n            }\r\n            this.getImagesList();\r\n            this.isImgShow = false;\r\n          });\r\n        })\r\n        .catch(() => {}); //注意这里，这里是重点！！！;\r\n    },\r\n    editImage(item) {\r\n      this.isImgShow = false;\r\n      this.isModify = true;\r\n      this.operateForm.classify = item.classify;\r\n      this.filename = item.filename;\r\n    },\r\n  },\r\n  computed: {\r\n    length() {\r\n      return this.countData.length;\r\n    },\r\n  },\r\n  created() {\r\n    this.getTokenUser();\r\n    this.getTagsList();\r\n    this.getImagesList();\r\n    this.getImagesTotal();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import \"../../src/assets/less/index.less\";\r\n.header-title {\r\n  text-align: center;\r\n  font-size: 30px;\r\n}\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: #409eff;\r\n}\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  line-height: 178px;\r\n  text-align: center;\r\n}\r\n.avatar {\r\n  width: 178px;\r\n  height: 178px;\r\n  display: block;\r\n}\r\n.dialog {\r\n  text-align: center;\r\n  width: 500px;\r\n  margin-left: 394px;\r\n  margin-top: -116px;\r\n  .img_title {\r\n    font-size: 20px;\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n.el-card-img {\r\n  float: left;\r\n  margin-right: 50px;\r\n  width: 26%;\r\n  margin-bottom: 20px;\r\n  text-align: center;\r\n}\r\n.dialog-img {\r\n  width: 80%;\r\n  margin-left: 100px;\r\n  text-align: center;\r\n  .webpath {\r\n    font-size: 20px;\r\n  }\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}