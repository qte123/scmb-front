{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.array.slice.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport CommonTag from \"../../src/components/CommonTag.vue\";\nimport CommonTable from \"../../src/components/CommonTable.vue\";\nimport CommonForm from \"../../src/components/CommonForm.vue\";\nimport { getImages } from \"../../api/data.js\";\nexport default {\n  name: \"Images\",\n  components: {\n    CommonTag: CommonTag,\n    CommonTable: CommonTable,\n    CommonForm: CommonForm\n  },\n  data: function data() {\n    return {\n      isShow: false,\n      tags: [],\n      tableData: [],\n      tableLabel: [{\n        prop: \"filename\",\n        label: \"图片名\",\n        width: 240\n      }, {\n        prop: \"webpath\",\n        label: \"图片网络地址\",\n        width: 410\n      }, {\n        prop: \"type\",\n        label: \"图片类型\"\n      }, {\n        prop: \"classify\",\n        label: \"图片分类\"\n      }, {\n        prop: \"add_date\",\n        label: \"图片上传时间\",\n        width: 200\n      }, {\n        prop: \"upload_user\",\n        label: \"上传者\"\n      }],\n      formLabel: [{\n        model: \"keyword\",\n        label: \"\",\n        type: \"input\"\n      }],\n      operateForm: {\n        classify: \"\"\n      },\n      operateFormLabel: [{\n        model: \"classify\",\n        label: \"图片分类\",\n        type: \"select\",\n        opts: []\n      }],\n      filename: \"\",\n      data: {\n        username: \"\"\n      },\n      user: {}\n    };\n  },\n  methods: {\n    getTagsList: function getTagsList() {\n      var _this = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_classify_list\");\n      getImages(param).then(function (res) {\n        _this.tags = res.data.retlist;\n        _this.operateFormLabel[0].opts = res.data.retlist.slice(1);\n      });\n    },\n    getImagesList: function getImagesList() {\n      var _this2 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_images_list\");\n      param.append(\"classify\", \"\");\n      getImages(param).then(function (res) {\n        _this2.tableData = res.data.retlist;\n      });\n    },\n    confirm: function confirm() {\n      var _this3 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"modify_image\");\n      param.append(\"classify\", this.operateForm.classify);\n      param.append(\"filename\", this.filename);\n      getImages(param).then(function (res) {\n        var ret = res.data[\"ret\"];\n        var msg = res.data[\"msg\"];\n\n        if (ret === 0) {\n          _this3.$message.success(msg);\n\n          _this3.isShow = false;\n        } else {\n          _this3.$message.error(msg);\n        }\n\n        _this3.getImagesList();\n      });\n    },\n    getTokenUser: function getTokenUser() {\n      this.$store.commit(\"getUser\");\n      this.user = JSON.parse(this.$store.state.user.user);\n      this.data.username = this.user.username;\n    },\n    editImage: function editImage(row) {\n      if (row.type === \"用户图片\") {\n        this.isShow = true;\n        this.operateForm.classify = row.classify;\n        this.filename = row.filename;\n      } else {\n        this.$message.error(\"用户头像信息不能修改\");\n      }\n    },\n    delImage: function delImage(row) {\n      var _this4 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"delete_image\");\n      param.append(\"username\", row.upload_user);\n      param.append(\"filename\", row.filename);\n      param.append(\"type\", row.type);\n      param.append(\"address\", \"image\");\n      this.$confirm(\"此操作将永久删除该图片,是否继续\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        getImages(param).then(function (res) {\n          var ret = res.data[\"ret\"];\n          var msg = res.data[\"msg\"];\n\n          if (ret === 0) {\n            _this4.$message.success(msg);\n          } else {\n            _this4.$message.error(msg);\n          }\n\n          _this4.getImagesList();\n        });\n      }).catch(function () {}); //注意这里，这里是重点！！！;\n    },\n    clickMenu: function clickMenu(item) {\n      var _this5 = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"get_images_list\");\n      param.append(\"classify\", item.value);\n      getImages(param).then(function (res) {\n        _this5.tableData = res.data.retlist;\n      });\n    }\n  },\n  created: function created() {\n    this.getTokenUser();\n    this.getTagsList();\n    this.getImagesList();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;AACA;AAEA;AACAA,gBADA;AAEAC;AACAC,wBADA;AAEAC,4BAFA;AAGAC;AAHA,GAFA;AAOAC,MAPA,kBAOA;AACA;AACAC,mBADA;AAEAC,cAFA;AAGAC,mBAHA;AAIAC,mBACA;AACAC,wBADA;AAEAC,oBAFA;AAGAC;AAHA,OADA,EAMA;AACAF,uBADA;AAEAC,uBAFA;AAGAC;AAHA,OANA,EAWA;AACAF,oBADA;AAEAC;AAFA,OAXA,EAeA;AACAD,wBADA;AAEAC;AAFA,OAfA,EAmBA;AACAD,wBADA;AAEAC,uBAFA;AAGAC;AAHA,OAnBA,EAwBA;AACAF,2BADA;AAEAC;AAFA,OAxBA,CAJA;AAiCAE,kBACA;AACAC,wBADA;AAEAH,iBAFA;AAGAI;AAHA,OADA,CAjCA;AAwCAC;AACAC;AADA,OAxCA;AA2CAC,yBACA;AACAJ,yBADA;AAEAH,qBAFA;AAGAI,sBAHA;AAIAI;AAJA,OADA,CA3CA;AAmDAC,kBAnDA;AAoDAf;AACAgB;AADA,OApDA;AAuDAC;AAvDA;AAyDA,GAjEA;AAkEAC;AACAC,eADA,yBACA;AAAA;;AACA;AACAC;AACAC;AACA;AACA;AACA,OAHA;AAIA,KARA;AASAC,iBATA,2BASA;AAAA;;AACA;AACAF;AACAA;AACAC;AACA;AACA,OAFA;AAGA,KAhBA;AAiBAE,WAjBA,qBAiBA;AAAA;;AACA;AACAH;AACAA;AACAA;AACAC;AACA;AACA;;AACA;AACA;;AACA;AACA,SAHA,MAGA;AACA;AACA;;AACA;AACA,OAVA;AAWA,KAjCA;AAkCAG,gBAlCA,0BAkCA;AACA;AACA;AACA;AACA,KAtCA;AAuCAC,aAvCA,qBAuCAC,GAvCA,EAuCA;AACA;AACA;AACA;AACA;AACA,OAJA,MAIA;AACA;AACA;AACA,KA/CA;AAgDAC,YAhDA,oBAgDAD,GAhDA,EAgDA;AAAA;;AACA;AACAN;AACAA;AACAA;AACAA;AACAA;AACA;AACAQ,+BADA;AAEAC,8BAFA;AAGAnB;AAHA,SAKAoB,IALA,CAKA;AACAT;AACA;AACA;;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;;AACA;AACA,SATA;AAUA,OAhBA,EAiBAU,KAjBA,CAiBA,cAjBA,EAPA,CAwBA;AACA,KAzEA;AA0EAC,aA1EA,qBA0EAC,IA1EA,EA0EA;AAAA;;AACA;AACAb;AACAA;AACAC;AACA;AACA,OAFA;AAGA;AAjFA,GAlEA;AAqJAa,SArJA,qBAqJA;AACA;AACA;AACA;AACA;AAzJA","names":["name","components","CommonTag","CommonTable","CommonForm","data","isShow","tags","tableData","tableLabel","prop","label","width","formLabel","model","type","operateForm","classify","operateFormLabel","opts","filename","username","user","methods","getTagsList","param","getImages","getImagesList","confirm","getTokenUser","editImage","row","delImage","confirmButtonText","cancelButtonText","then","catch","clickMenu","item","created"],"sourceRoot":"views/images","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1 class=\"title\">图片分类:</h1>\r\n    <common-tag :tags=\"tags\" @clickMenu=\"clickMenu\"></common-tag>\r\n    <!-- <div class=\"manage-header\">\r\n      <common-form\r\n        :formLabel=\"formLabel\"\r\n        :form=\"searchForm\"\r\n        :inline=\"true\"\r\n        ref=\"form\"\r\n      >\r\n        <el-button type=\"primary\" @click=\"getList(searchForm.keyword)\"\r\n          >搜索</el-button\r\n        >\r\n      </common-form>\r\n    </div> -->\r\n    <el-dialog title=\"修改图片信息\" :visible.sync=\"isShow\">\r\n      <common-form\r\n        :formLabel=\"operateFormLabel\"\r\n        :form=\"operateForm\"\r\n        :inline=\"true\"\r\n        ref=\"form\"\r\n      />\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"isShow = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirm\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <common-table\r\n      :tableData=\"tableData\"\r\n      :tableLabel=\"tableLabel\"\r\n      @edit=\"editImage\"\r\n      @delete=\"delImage\"\r\n    ></common-table>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CommonTag from \"../../src/components/CommonTag.vue\";\r\nimport CommonTable from \"../../src/components/CommonTable.vue\";\r\nimport CommonForm from \"../../src/components/CommonForm.vue\";\r\nimport { getImages } from \"../../api/data.js\";\r\n\r\nexport default {\r\n  name: \"Images\",\r\n  components: {\r\n    CommonTag,\r\n    CommonTable,\r\n    CommonForm,\r\n  },\r\n  data() {\r\n    return {\r\n      isShow: false,\r\n      tags: [],\r\n      tableData: [],\r\n      tableLabel: [\r\n        {\r\n          prop: \"filename\",\r\n          label: \"图片名\",\r\n          width: 240,\r\n        },\r\n        {\r\n          prop: \"webpath\",\r\n          label: \"图片网络地址\",\r\n          width: 410,\r\n        },\r\n        {\r\n          prop: \"type\",\r\n          label: \"图片类型\",\r\n        },\r\n        {\r\n          prop: \"classify\",\r\n          label: \"图片分类\",\r\n        },\r\n        {\r\n          prop: \"add_date\",\r\n          label: \"图片上传时间\",\r\n          width: 200,\r\n        },\r\n        {\r\n          prop: \"upload_user\",\r\n          label: \"上传者\",\r\n        },\r\n      ],\r\n      formLabel: [\r\n        {\r\n          model: \"keyword\",\r\n          label: \"\",\r\n          type: \"input\",\r\n        },\r\n      ],\r\n      operateForm: {\r\n        classify: \"\",\r\n      },\r\n      operateFormLabel: [\r\n        {\r\n          model: \"classify\",\r\n          label: \"图片分类\",\r\n          type: \"select\",\r\n          opts: [],\r\n        },\r\n      ],\r\n      filename: \"\",\r\n      data: {\r\n        username: \"\",\r\n      },\r\n      user: {},\r\n    };\r\n  },\r\n  methods: {\r\n    getTagsList() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_classify_list\");\r\n      getImages(param).then((res) => {\r\n        this.tags = res.data.retlist;\r\n        this.operateFormLabel[0].opts = res.data.retlist.slice(1);\r\n      });\r\n    },\r\n    getImagesList() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_images_list\");\r\n      param.append(\"classify\", \"\");\r\n      getImages(param).then((res) => {\r\n        this.tableData = res.data.retlist;\r\n      });\r\n    },\r\n    confirm() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"modify_image\");\r\n      param.append(\"classify\", this.operateForm.classify);\r\n      param.append(\"filename\", this.filename);\r\n      getImages(param).then((res) => {\r\n        var ret = res.data[\"ret\"];\r\n        var msg = res.data[\"msg\"];\r\n        if (ret === 0) {\r\n          this.$message.success(msg);\r\n           this.isShow = false;\r\n        } else {\r\n          this.$message.error(msg);\r\n        }\r\n        this.getImagesList();\r\n      });\r\n    },\r\n    getTokenUser() {\r\n      this.$store.commit(\"getUser\");\r\n      this.user = JSON.parse(this.$store.state.user.user);\r\n      this.data.username = this.user.username;\r\n    },\r\n    editImage(row) {\r\n      if (row.type === \"用户图片\") {\r\n        this.isShow = true;\r\n        this.operateForm.classify = row.classify;\r\n        this.filename = row.filename;\r\n      } else {\r\n        this.$message.error(\"用户头像信息不能修改\");\r\n      }\r\n    },\r\n    delImage(row) {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"delete_image\");\r\n      param.append(\"username\", row.upload_user);\r\n      param.append(\"filename\", row.filename);\r\n      param.append(\"type\", row.type);\r\n      param.append(\"address\", \"image\");\r\n      this.$confirm(\"此操作将永久删除该图片,是否继续\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(() => {\r\n          getImages(param).then((res) => {\r\n            var ret = res.data[\"ret\"];\r\n            var msg = res.data[\"msg\"];\r\n            if (ret === 0) {\r\n              this.$message.success(msg);\r\n            } else {\r\n              this.$message.error(msg);\r\n            }\r\n            this.getImagesList();\r\n          });\r\n        })\r\n        .catch(() => {}); //注意这里，这里是重点！！！;\r\n    },\r\n    clickMenu(item) {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"get_images_list\");\r\n      param.append(\"classify\", item.value);\r\n      getImages(param).then((res) => {\r\n        this.tableData = res.data.retlist;\r\n      });\r\n    },\r\n  },\r\n  created() {\r\n    this.getTokenUser();\r\n    this.getTagsList();\r\n    this.getImagesList();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import \"../../src/assets/less/index.less\";\r\n</style>"]},"metadata":{},"sourceType":"module"}