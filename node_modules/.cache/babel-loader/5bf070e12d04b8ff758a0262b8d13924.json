{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: \"Upload\",\n  data: function data() {\n    return {\n      action: \"/api/upload/upload_image/\",\n      data: {\n        username: \"\"\n      }\n    };\n  },\n  inject: [\"reload\"],\n  methods: {\n    before: function before(file) {\n      var filename = file.name;\n      var size = file.size;\n      var suffix = filename.substring(filename.lastIndexOf(\".\") + 1);\n\n      if (suffix !== \"jpg\") {\n        this.$message.error(\"图片格式有误\");\n        return false;\n      }\n\n      if (file > 524288000) {\n        this.$message.error(\"图片大小超过限制\");\n        return false;\n      }\n    },\n    success: function success(response, file, fileList) {\n      console.log(response);\n      var ret = response[\"ret\"];\n      var msg = response[\"msg\"];\n\n      if (ret === 0) {\n        this.$message.success(\"图片上传成功\");\n        console.log(\"success\");\n        this.reload();\n      } else {\n        this.$message.error(\"图片格式有误\");\n      }\n    },\n    loading: function loading(event, file, fileList) {\n      this.$message.success(\"图片正在上传，请稍等......\");\n    },\n    error: function error(err, file, fileList) {\n      this.$message.error(\"图片上传失败\");\n      console.log(\"error\");\n    },\n    getTokenUser: function getTokenUser() {\n      this.$store.commit(\"getUser\");\n      this.user = JSON.parse(this.$store.state.user.user);\n      this.data.username = this.user.username;\n    }\n  },\n  created: function created() {\n    this.getTokenUser();\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACAA,gBADA;AAEAC,MAFA,kBAEA;AACA;AACAC,yCADA;AAEAD;AACAE;AADA;AAFA;AAMA,GATA;AAUAC,oBAVA;AAWAC;AACAC,UADA,kBACAC,IADA,EACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,KAbA;AAcAC,WAdA,mBAcAC,QAdA,EAcAF,IAdA,EAcAG,QAdA,EAcA;AACAC;AACA;AACA;;AACA;AACA;AACAA;AACA;AACA,OAJA,MAIA;AACA;AACA;AACA,KAzBA;AA0BAC,WA1BA,mBA0BAC,KA1BA,EA0BAN,IA1BA,EA0BAG,QA1BA,EA0BA;AACA;AACA,KA5BA;AA6BAI,SA7BA,iBA6BAC,GA7BA,EA6BAR,IA7BA,EA6BAG,QA7BA,EA6BA;AACA;AACAC;AACA,KAhCA;AAiCAK,gBAjCA,0BAiCA;AACA;AACA;AACA;AACA;AArCA,GAXA;AAkDAC,SAlDA,qBAkDA;AACA;AACA;AApDA","names":["name","data","action","username","inject","methods","before","file","success","response","fileList","console","loading","event","error","err","getTokenUser","created"],"sourceRoot":"views/upload","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div class=\"upload\">\r\n    <el-upload\r\n      class=\"upload-demo\"\r\n      drag\r\n      :action=\"action\"\r\n      multiple\r\n      :before-upload=\"before\"\r\n      :on-success=\"success\"\r\n      :on-progress=\"loading\"\r\n      :on-error=\"error\"\r\n      :data=\"data\"\r\n    >\r\n      <i class=\"el-icon-upload\"></i>\r\n      <div class=\"el-upload__text\">将图片拖到此处，或<em>点击上传</em></div>\r\n      <div class=\"el-upload__tip\" slot=\"tip\">\r\n        只能上传jpg文件，且不超过500kb\r\n      </div>\r\n    </el-upload>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Upload\",\r\n  data() {\r\n    return {\r\n      action: \"/api/upload/upload_image/\",\r\n      data: {\r\n        username: \"\",\r\n      },\r\n    };\r\n  },\r\n  inject: [\"reload\"],\r\n  methods: {\r\n    before(file){\r\n      var filename=file.name\r\n      var size=file.size\r\n      var suffix=filename.substring(filename.lastIndexOf(\".\")+1);\r\n      if(suffix!==\"jpg\"){\r\n        this.$message.error(\"图片格式有误\");\r\n        return false\r\n      }\r\n      if(file > 524288000){\r\n        this.$message.error(\"图片大小超过限制\");\r\n        return false\r\n      }\r\n    },\r\n    success(response, file, fileList) {\r\n      console.log(response);\r\n      var ret = response[\"ret\"];\r\n      var msg = response[\"msg\"];\r\n      if (ret === 0) {\r\n        this.$message.success(\"图片上传成功\");\r\n        console.log(\"success\");\r\n        this.reload();\r\n      } else {\r\n        this.$message.error(\"图片格式有误\");\r\n      }\r\n    },\r\n    loading(event, file, fileList) {\r\n      this.$message.success(\"图片正在上传，请稍等......\");\r\n    },\r\n    error(err, file, fileList) {\r\n      this.$message.error(\"图片上传失败\");\r\n      console.log(\"error\");\r\n    },\r\n    getTokenUser() {\r\n      this.$store.commit(\"getUser\");\r\n      this.user = JSON.parse(this.$store.state.user.user);\r\n      this.data.username = this.user.username;\r\n    },\r\n  },\r\n  created() {\r\n    this.getTokenUser();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.upload {\r\n  height: 1000px;\r\n  text-align: center;\r\n  margin-top: 300px;\r\n  .el-upload__text {\r\n    font-size: 20px;\r\n    color: #ccc;\r\n  }\r\n  .el-upload__tip {\r\n    font-size: 30px;\r\n    color: #ccc;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}