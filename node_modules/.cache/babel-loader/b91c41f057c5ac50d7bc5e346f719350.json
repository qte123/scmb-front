{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url-search-params.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { login as _login, getUser } from \"../../api/data.js\";\nimport CommonForm from \"../../src/components/CommonForm.vue\";\nexport default {\n  name: \"Login\",\n  components: {\n    CommonForm: CommonForm\n  },\n  data: function data() {\n    return {\n      isShow: false,\n      form: {\n        username: \"\",\n        password: \"\"\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: \"请输入用户名\",\n          trigger: \"blur\"\n        }, {\n          min: 3,\n          max: 9,\n          message: \"用户名长度在3-9个字符之间\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"请输入密码\",\n          trigger: \"blur\"\n        }, {\n          min: 6,\n          max: 18,\n          message: \"密码长度在6-18个字符之间\",\n          trigger: \"blur\"\n        }]\n      },\n      usernameForm: {\n        username: \"\",\n        code: \"\"\n      },\n      usernameFormLabel: [{\n        model: \"username\",\n        label: \"用户名\",\n        type: \"input\"\n      }, {\n        model: \"code\",\n        label: \"邀请码\",\n        type: \"input\"\n      }]\n    };\n  },\n  methods: {\n    openDialog: function openDialog() {\n      this.isShow = true;\n    },\n    resetPassword: function resetPassword() {\n      var _this = this;\n\n      var param = new URLSearchParams();\n      param.append(\"action\", \"reset_password\");\n      param.append(\"username\", this.usernameForm.username);\n      param.append(\"address\", \"login\");\n      param.append(\"code\", this.usernameForm.code);\n      getUser(param).then(function (res) {\n        var ret = res.data[\"ret\"];\n        var msg = res.data[\"msg\"];\n\n        if (ret === 0) {\n          _this.$message.success(msg);\n\n          _this.isShow = false;\n        } else {\n          _this.$message.error(msg);\n        }\n      });\n    },\n    login: function login() {\n      var _this2 = this;\n\n      var username = this.form.username;\n      var password = this.form.password;\n\n      if (username !== \"\" && password !== \"\") {\n        var param = new URLSearchParams();\n        param.append(\"username\", username);\n        param.append(\"password\", password);\n\n        _login(param).then(function (res) {\n          var ret = res.data[\"ret\"];\n          var msg = res.data[\"msg\"];\n\n          if (ret === 0) {\n            _this2.$message.success(msg);\n\n            console.log(res.data.menu);\n\n            _this2.$store.commit(\"clearMenu\");\n\n            _this2.$store.commit(\"setMenu\", res.data.menu);\n\n            _this2.$store.commit(\"setToken\", res.data.token);\n\n            _this2.$store.commit(\"setUser\", res.data.user);\n\n            _this2.$store.commit(\"setUsername\", JSON.parse(res.data.user).username);\n\n            _this2.$store.commit(\"addMenu\", _this2.$router);\n\n            _this2.$router.push({\n              name: \"Home\"\n            });\n          } else {\n            _this2.$message.error(msg);\n          }\n        });\n      } else {\n        this.$message.error(\"用户名或密码为空\");\n      }\n    },\n    register: function register() {\n      this.$router.push({\n        name: \"Register\"\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AAEA;AACA;AACAA,eADA;AAEAC;AAAAC;AAAA,GAFA;AAGAC,MAHA,kBAGA;AACA;AACAC,mBADA;AAEAC;AACAC,oBADA;AAEAC;AAFA,OAFA;AAMAC;AACAF,mBACA;AAAAG;AAAAC;AAAAC;AAAA,SADA,EAEA;AACAC,gBADA;AAEAC,gBAFA;AAGAH,mCAHA;AAIAC;AAJA,SAFA,CADA;AAUAJ,mBACA;AAAAE;AAAAC;AAAAC;AAAA,SADA,EAEA;AACAC,gBADA;AAEAC,iBAFA;AAGAH,mCAHA;AAIAC;AAJA,SAFA;AAVA,OANA;AA0BAG;AACAR,oBADA;AAEAS;AAFA,OA1BA;AA8BAC,0BACA;AACAC,yBADA;AAEAC,oBAFA;AAGAC;AAHA,OADA,EAMA;AACAF,qBADA;AAEAC,oBAFA;AAGAC;AAHA,OANA;AA9BA;AA2CA,GA/CA;AAgDAC;AACAC,cADA,wBACA;AACA;AACA,KAHA;AAIAC,iBAJA,2BAIA;AAAA;;AACA;AACAC;AACAA;AACAA;AACAA;AACAC;AACA;AACA;;AACA;AACA;;AACA;AACA,SAHA,MAGA;AACA;AACA;AACA,OATA;AAUA,KApBA;AAqBAC,SArBA,mBAqBA;AAAA;;AACA;AACA;;AACA;AACA;AACAF;AACAA;;AACAE;AACA;AACA;;AACA;AACA;;AACAC;;AACA;;AACA;;AACA;;AACA;;AACA,iCACA,aADA,EAEAC,kCAFA;;AAIA;;AACA;AAAA3B;AAAA;AACA,WAbA,MAaA;AACA;AACA;AACA,SAnBA;AAoBA,OAxBA,MAwBA;AACA;AACA;AACA,KAnDA;AAoDA4B,YApDA,sBAoDA;AACA;AAAA5B;AAAA;AACA;AAtDA;AAhDA","names":["name","components","CommonForm","data","isShow","form","username","password","rules","required","message","trigger","min","max","usernameForm","code","usernameFormLabel","model","label","type","methods","openDialog","resetPassword","param","getUser","login","console","JSON","register"],"sourceRoot":"views/login","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-dialog title=\"重置管理员密码\" :visible.sync=\"isShow\">\r\n      <common-form\r\n        :formLabel=\"usernameFormLabel\"\r\n        :form=\"usernameForm\"\r\n        :inline=\"true\"\r\n        ref=\"form\"\r\n      />\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"isShow = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"resetPassword\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n    <el-form\r\n      :model=\"form\"\r\n      status-icon\r\n      :rules=\"rules\"\r\n      ref=\"form\"\r\n      label-width=\"100px\"\r\n      class=\"login-container\"\r\n    >\r\n      <h3 class=\"login-title\">图床登录</h3>\r\n      <el-form-item\r\n        label=\"用户名\"\r\n        label-width=\"80px\"\r\n        prop=\"username\"\r\n        class=\"username\"\r\n      >\r\n        <el-input\r\n          type=\"input\"\r\n          v-model=\"form.username\"\r\n          autocomplete=\"off\"\r\n          placeholder=\"请输入用户名\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"密码\" label-width=\"80px\" prop=\"password\">\r\n        <el-input\r\n          type=\"password\"\r\n          v-model=\"form.password\"\r\n          autocomplete=\"off\"\r\n          placeholder=\"请输入密码\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item class=\"login-submit\"\r\n        ><el-button type=\"primary\" @click=\"login\" class=\"login-submit\"\r\n          >登录</el-button\r\n        ><el-button type=\"primary\" @click=\"register\" class=\"login-submit\"\r\n          >注册</el-button\r\n        >\r\n      </el-form-item>\r\n      <div style=\"text-align: center; font-size: 15px\">\r\n        <h4>普通用户忘记密码请联系管理员重置密码！</h4>\r\n        <el-button @click=\"openDialog\">管理员重置密码入口</el-button>\r\n      </div>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { login, getUser } from \"../../api/data.js\";\r\n\r\nimport CommonForm from \"../../src/components/CommonForm.vue\";\r\nexport default {\r\n  name: \"Login\",\r\n  components: { CommonForm },\r\n  data() {\r\n    return {\r\n      isShow: false,\r\n      form: {\r\n        username: \"\",\r\n        password: \"\",\r\n      },\r\n      rules: {\r\n        username: [\r\n          { required: true, message: \"请输入用户名\", trigger: \"blur\" },\r\n          {\r\n            min: 3,\r\n            max: 9,\r\n            message: \"用户名长度在3-9个字符之间\",\r\n            trigger: \"blur\",\r\n          },\r\n        ],\r\n        password: [\r\n          { required: true, message: \"请输入密码\", trigger: \"blur\" },\r\n          {\r\n            min: 6,\r\n            max: 18,\r\n            message: \"密码长度在6-18个字符之间\",\r\n            trigger: \"blur\",\r\n          },\r\n        ],\r\n      },\r\n      usernameForm: {\r\n        username: \"\",\r\n        code: \"\",\r\n      },\r\n      usernameFormLabel: [\r\n        {\r\n          model: \"username\",\r\n          label: \"用户名\",\r\n          type: \"input\",\r\n        },\r\n        {\r\n          model: \"code\",\r\n          label: \"邀请码\",\r\n          type: \"input\",\r\n        },\r\n      ],\r\n    };\r\n  },\r\n  methods: {\r\n    openDialog() {\r\n      this.isShow = true;\r\n    },\r\n    resetPassword() {\r\n      let param = new URLSearchParams();\r\n      param.append(\"action\", \"reset_password\");\r\n      param.append(\"username\", this.usernameForm.username);\r\n      param.append(\"address\", \"login\");\r\n      param.append(\"code\", this.usernameForm.code);\r\n      getUser(param).then((res) => {\r\n        var ret = res.data[\"ret\"];\r\n        var msg = res.data[\"msg\"];\r\n        if (ret === 0) {\r\n          this.$message.success(msg);\r\n          this.isShow = false;\r\n        } else {\r\n          this.$message.error(msg);\r\n        }\r\n      });\r\n    },\r\n    login() {\r\n      var username = this.form.username;\r\n      var password = this.form.password;\r\n      if (username !== \"\" && password !== \"\") {\r\n        let param = new URLSearchParams();\r\n        param.append(\"username\", username);\r\n        param.append(\"password\", password);\r\n        login(param).then((res) => {\r\n          var ret = res.data[\"ret\"];\r\n          var msg = res.data[\"msg\"];\r\n          if (ret === 0) {\r\n            this.$message.success(msg);\r\n            console.log(res.data.menu);\r\n            this.$store.commit(\"clearMenu\");\r\n            this.$store.commit(\"setMenu\", res.data.menu);\r\n            this.$store.commit(\"setToken\", res.data.token);\r\n            this.$store.commit(\"setUser\", res.data.user);\r\n            this.$store.commit(\r\n              \"setUsername\",\r\n              JSON.parse(res.data.user).username\r\n            );\r\n            this.$store.commit(\"addMenu\", this.$router);\r\n            this.$router.push({ name: \"Home\" });\r\n          } else {\r\n            this.$message.error(msg);\r\n          }\r\n        });\r\n      } else {\r\n        this.$message.error(\"用户名或密码为空\");\r\n      }\r\n    },\r\n    register() {\r\n      this.$router.push({ name: \"Register\" });\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.login-container {\r\n  border-radius: 15px;\r\n  background-clip: padding-box;\r\n  margin: 180px auto;\r\n  width: 350px;\r\n  padding: 35px 35px 15px 35px;\r\n  background-color: #fff;\r\n  border: 1px solid #eaeaea;\r\n  box-shadow: 0 0 25px #cac6c6;\r\n}\r\n\r\n.login-title {\r\n  margin: 0px auto 40px auto;\r\n  text-align: center;\r\n  color: #505458;\r\n}\r\n\r\n.login-submit {\r\n  margin: 10px 10px 0px auto;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}